<h2 class="titulo-seccion"> Tipos de Contrato</h2>

<div class="mensaje-info" *ngIf="cargandoTipos">
  Cargando tipos de contrato...
</div>
<div class="mensaje-vacio" *ngIf="!cargandoTipos && tiposContrato.length === 0 && !errorTipos">
  No hay tipos de contrato registrados.
</div>
<div class="mensaje-error" *ngIf="errorTipos">
  OcurriÃ³ un error al cargar los tipos de contrato.
</div>

<!-- ----------------------------------Reglas-------------------------------------------- -->
<div class="nueva-regla-contrato">
  <h4>âž• Crear nueva regla de contrato</h4>
  <input [(ngModel)]="nuevaRegla['nombre']" />


  <div class="checkboxes">
    <label *ngFor="let campo of getClaves(nuevaRegla)">
      <input type="checkbox" [(ngModel)]="nuevaRegla[campo]" />
      {{ formatearTexto(campo) }}
    </label>
  </div>

  <button (click)="agregarRegla()">Crear regla</button>
</div>
<!-- ----------------------------------Reglas-Fin------------------------------------------- -->


<!-- ----------------------------------CrearTipo-------------------------------------------- -->
<div class="nuevo-tipo-contrato">
  <h4>âž• Crear nuevo tipo de contrato</h4>
  <input [(ngModel)]="nuevoTipoContrato.nombre" placeholder="Nombre del tipo de contrato" />
  <select [(ngModel)]="nuevoTipoContrato.reglas">
    <option *ngFor="let regla of reglas" [value]="regla.id">
      {{ regla.nombre }}
    </option>
  </select>
  <button (click)="agregarTipoContrato()">Crear</button>
</div>


<!-- ----------------------------------CrearTipo-Fin----------------------------------------- -->
<div class="lista grid-contratos">
  <div class="contrato-card" *ngFor="let tipo of tiposContrato">
    <div *ngIf="tipoEditando?.id !== tipo.id">
      <h3>{{ tipo.nombre }}</h3>
      <p class="regla-aplicada">ðŸ”— Regla: {{ tipo.reglas_nombre || 'No asignada' }}</p>
      <div class="acciones">
        <button (click)="editarTipo(tipo)">Editar</button>
        <button (click)="eliminarTipoContrato(tipo.id)"> Eliminar</button>
        <button (click)="abrirModalReglas(tipo)">Editar reglas</button>
      </div>
    </div>

    <div *ngIf="tipoEditando?.id === tipo.id" class="edicion-contrato">
      <input [(ngModel)]="tipoEditando.nombre" placeholder="Nuevo nombre" />
      <button (click)="guardarEdicionTipo()"> Guardar</button>
      <button (click)="cancelarEdicionTipo()"> Cancelar</button>
    </div>
  </div>
</div>
<!-- ðŸªŸ Ventana emergente para editar reglas -->
<div class="modal-reglas" *ngIf="tipoParaEditarReglas" (click)="cerrarModalReglas()">
  <div class="modal-contenido" (click)="$event.stopPropagation()">
    <h3>Editar reglas para: {{ tipoParaEditarReglas.nombre }}</h3>

    <div class="checkboxes">
      <label *ngFor="let campo of [
        'requiere_cotizaciones',
        'controla_asistencia',
        'requiere_liquidacion',
        'genera_vacaciones',
        'afecta_antiguedad',
        'requiere_firma_digital',
        'aplica_seguro_invalidez'
      ]">
        <input type="checkbox" [(ngModel)]="tipoParaEditarReglas[campo]" />
        {{ formatearTexto(campo) }}
      </label>
    </div>

    <div class="acciones">
      <button (click)="guardarReglasEditadas()"> Guardar</button>
      <button (click)="cerrarModalReglas()"> Cancelar</button>
    </div>
  </div>
</div>
<app-contrato-asignacion [visible]="modalAsignarVisible" (cerrado)="modalAsignarVisible = false"
  (contratoGuardado)="cargarTiposContrato()">
</app-contrato-asignacion>

<button (click)="modalAsignarVisible = true">
  âž• Asignar contrato
</button>